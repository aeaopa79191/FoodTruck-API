{"version":3,"sources":["../../src/controller/account.js"],"names":["config","db","api","post","req","res","register","username","body","email","password","err","account","send","authenticate","session","status","scope","get","logout","json","user"],"mappings":";;;;;;AAAA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;kBAEc,gBAAe;AAAA,MAAbA,MAAa,QAAbA,MAAa;AAAA,MAANC,EAAM,QAANA,EAAM;;AAC3B,MAAIC,MAAM,sBAAV;;AAEA;AACAA,MAAIC,IAAJ,CAAS,WAAT,EAAsB,UAACC,GAAD,EAAKC,GAAL,EAAY;AAChC,sBAAQC,QAAR,CAAiB,sBAAY,EAACC,UAAUH,IAAII,IAAJ,CAASC,KAApB,EAAZ,CAAjB,EAA0DL,IAAII,IAAJ,CAASE,QAAnE,EAA6E,UAAUC,GAAV,EAAcC,OAAd,EAAsB;AACjG,UAAGD,GAAH,EAAO;AACLN,YAAIQ,IAAJ,CAASF,GAAT;AACD;AACD,yBAASG,YAAT,CACE,OADF,EACU;AACNC,iBAAS;AADH,OADV,EAGKX,GAHL,EAGSC,GAHT,EAGa,YAAK;AACdA,YAAIW,MAAJ,CAAW,GAAX,EAAgBH,IAAhB,CAAqB,kCAArB;AACD,OALH;AAMD,KAVD;AAWD,GAZD;;AAeF;AACAX,MAAIC,IAAJ,CAAS,QAAT,EAAkB,mBAASW,YAAT,CAChB,OADgB,EACR;AACNC,aAAS,KADH;AAENE,WAAM;AAFA,GADQ,CAAlB;;AAMA;AACAf,MAAIgB,GAAJ,CAAQ,SAAR,gCAA+B,UAACd,GAAD,EAAKC,GAAL,EAAW;AACxCA,QAAIc,MAAJ;AACAd,QAAIW,MAAJ,CAAW,GAAX,EAAgBH,IAAhB,CAAqB,yBAArB;AACD,GAHD;;AAKAX,MAAIgB,GAAJ,CAAQ,KAAR,gCAA4B,UAACd,GAAD,EAAKC,GAAL,EAAW;AACrCA,QAAIW,MAAJ,CAAW,GAAX,EAAgBI,IAAhB,CAAqBhB,IAAIiB,IAAzB;AACD,GAFD;;AAIE,SAAOnB,GAAP;AACD,C","file":"account.js","sourcesContent":["import mongoose from 'mongoose';\nimport{Router} from 'express';\nimport Account from '../model/account';\nimport bodyParser from 'body-parser';\nimport passport from 'passport';\nimport config from '../config';\n\nimport{generateAccessToken,respond,authenticate} from '../middleware/authMiddleware';\n\nexport default({config,db})=>{\n  let api = Router();\n\n  //'./v1/account'\n  api.post('/register', (req,res) =>{\n    Account.register(new Account({username: req.body.email}), req.body.password, function (err,account){\n      if(err){\n        res.send(err);\n      }\n      passport.authenticate(\n        'local',{\n          session: false\n        })(req,res,() =>{\n          res.status(200).send('Successfully created new account');\n        });\n    });\n  });\n\n\n//'/v1/account/login'\napi.post('/login',passport.authenticate(\n  'local',{\n    session: false,\n    scope:[]\n  }), generateAccessToken,respond);\n\n// '/v1/account/logout'\napi.get('/logout',authenticate,(req,res)=>{\n  res.logout();\n  res.status(200).send('Successfully logged out');\n});\n\napi.get('/me', authenticate,(req,res)=>{\n  res.status(200).json(req.user);\n});\n\n  return api;\n}\n"]}